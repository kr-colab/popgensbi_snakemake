# --- top level arguments are ALWAYS REQUIRED --- #

# change this to the project directory you want to use
project_dir: "/sietch_colab/data_share/popgen_npe/ooa2T12-1000g"

cpu_resources: # optional, used for CPU-only tasks (simulation)
  runtime: "2h"
  mem_mb: 16000

gpu_resources: # optional, used for GPU tasks (training)
  runtime: "4h"
  mem_mb: 50000
  gpus: 1
  slurm_partition: "kerngpu,gpu"
  slurm_extra: "--gres=gpu:1 --constraint=a100"

random_seed: 1
n_chunk: 50 # number of instances to simulate per worker
n_train: 10000
n_val: 1000
n_test: 1000

train_embedding_net_separately: False # train embedding network separately from normalizing flow
use_cache: True # load features into CPU memory
optimizer: "Adam"
batch_size: 32
learning_rate: 0.0005
max_num_epochs: 2000
stop_after_epochs: 100
clip_max_norm: 5
packed_sequence: False

simulator:
  class_name: "OutOfAfrica_2T12"
  # OPTIONAL CLASS KWARGS:
  sequence_length: 10000000
  mutation_rate: 1.14e-8  # 1.29e-8 adjusted for ~10% unpolarized SNPs
  recombination_rate: [5.0e-9, 2.0e-8]
  samples:
    AFR: 50
    EUR: 50

processor:
  class_name: "tskit_sfs"
  # OPTIONAL CLASS KWARGS:
  sample_sets: ["AFR", "EUR"]
  windows: null
  mode: "site"
  span_normalise: True
  polarised: True
  normalised: False
  log1p: True
  project_to: [20, 20]

embedding_network:
  class_name: "SummaryStatisticsEmbedding"

prediction:
  n_chunk: 50
  vcf: "/sietch_colab/data_share/popgen_npe/ooa2T12-1000g/data/vcf.gz"
  ancestral_fasta: "/sietch_colab/data_share/popgen_npe/ooa2T12-1000g/data/fa.gz"
  population_map: "/sietch_colab/data_share/popgen_npe/ooa2T12-1000g/data/yml" # subset of samples, with populations
  windows: "/sietch_colab/data_share/popgen_npe/ooa2T12-1000g/data/bed" # windows to predict over
  min_snps_per_window: 1000 # filter out low-density windows

